<?xml version='1.0' ?>
<BuildGraph xmlns="http://www.epicgames.com/BuildGraph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.epicgames.com/BuildGraph ../Schema.xsd" >
	
	<Agent Name="Agent 1" Type="CompileWin64">
		<Node Name="Manipulate Some Files">
			<Log Message="Here are all the files in Engine/Build/..." Files="Engine/Build/..."/>

			<!-- Clean up all the test output folders for when we're running locally (note wildcard for matching directories!). We're just filtering files to delete here, empty folders will be deleted automatically. -->
			<Delete Files="Engine/TestNumber?/..."/>

			<!-- Test #1: Copy all the files in Engine/Build to Engine/TestNumber1, and delete all the batch files and contents of the Android folder -->
			<Copy FromDir="Engine/Build" Files="..." ToDir="Engine/TestNumber1"/>
			<Delete Files="Engine/TestNumber1/.../*.bat;Engine/TestNumber1/.../*.sh;Engine/TestNumber1/Android/..."/>
			<Log Message="Here are all the files in Engine/TestNumber1/..." Files="Engine/TestNumber1/..."/>

			<!-- Test #2: Copy all the files in Engine/Build except for batch files and the Android folder to Engine/TestNumber2 -->
			<Tag Files="Engine/Build/..." Except="*.bat;*.sh;.../Android/..." With="#AllFilesExceptBatchFiles"/>
			<Copy FromDir="Engine/Build" Files="#AllFilesExceptBatchFiles" ToDir="Engine/TestNumber2"/>
			<Log Message="Here are all the files in Engine/TestNumber2/..." Files="Engine/TestNumber2/..."/>

			<!-- Test #3: Copy all the text files and batch files to Engine/TestNumber3 -->
			<Tag Files="Engine/Build/..." Filter="*.txt;*.md" With="#TextFilesAndBatchFiles"/>
			<Tag Files="Engine/Build/..." Filter="*.bat;*.sh" With="#TextFilesAndBatchFiles"/>
			<Copy FromDir="Engine/Build" Files="#TextFilesAndBatchFiles" ToDir="Engine/TestNumber3"/>
			<Log Message="Here are all the files in Engine/TestNumber3/..." Files="Engine/TestNumber3/..."/>

		</Node>
	</Agent>
	<Agent Name="Agent 2" Type="CompileWin64">
		<Node Name="First Downstream Node" Requires="Manipulate Some Files">
			<!-- Test that we have all the side-effects of tests 1-3 from the 'Manipulate Some Files' node -->
			<Log Message="Here are all the files in Engine/TestNumber1/..." Files="Engine/TestNumber1/..."/>
			<Log Message="Here are all the files in Engine/TestNumber2/..." Files="Engine/TestNumber2/..."/>
			<Log Message="Here are all the files in Engine/TestNumber3/..." Files="Engine/TestNumber3/..."/>
		</Node>
		<Node Name="Create A Named Output" Requires="First Downstream Node" Produces="#OutputForTestNumber5">
			<!-- Node that node dependencies are recursive - we get all the build products from 'Manipulate Some Files' because we're dependent on 'First Downstream Node'. -->
			<Log Message="Here are all the files in Engine/TestNumber1/..." Files="Engine/TestNumber1/..."/>
			<Log Message="Here are all the files in Engine/TestNumber2/..." Files="Engine/TestNumber2/..."/>
			<Log Message="Here are all the files in Engine/TestNumber3/..." Files="Engine/TestNumber3/..."/>

			<!-- Test #4: Just a copy of test #3 -->
			<Copy FromDir="Engine/TestNumber3" Files="..." ToDir="Engine/TestNumber4"/>

			<!-- Test #5: Copy them somewhere else and tag them as an output -->
			<Copy FromDir="Engine/TestNumber4" Files="..." ToDir="Engine/TestNumber5"/>
			<Tag Files="Engine/TestNumber5/..." With="#OutputForTestNumber5"/>
			<Log Message="Produced files:" Files="#OutputForTestNumber5"/>
		</Node>
	</Agent>
	<Agent Name="Agent 3" Type="CompileWin64">
		<Node Name="Consume a Single Named Output" Requires="#OutputForTestNumber5">
			<!-- Show that we ONLY have the #OutputForTestNumber5 output -->
			<Log Message="Here are all the files in Engine/TestNumber1/..." Files="Engine/TestNumber1/..."/>
			<Log Message="Here are all the files in Engine/TestNumber2/..." Files="Engine/TestNumber2/..."/>
			<Log Message="Here are all the files in Engine/TestNumber3/..." Files="Engine/TestNumber3/..."/>
			<Log Message="Here are all the files in Engine/TestNumber4/..." Files="Engine/TestNumber4/..."/>
			<Log Message="Here are all the files in Engine/TestNumber5/..." Files="Engine/TestNumber5/..."/>
		</Node>
	</Agent>
	<Trigger Name="Test Trigger">
		<Agent Name="Trigger Group" Type="CompileWin64">
			<Node Name="Print all Output Folders" Requires="Manipulate Some Files;Create A Named Output">
				<!-- Test that we have all the side-effects of the upstream node -->
				<Log Message="Here are all the files in Engine/TestNumber1/..." Files="Engine/TestNumber1/..."/>
				<Log Message="Here are all the files in Engine/TestNumber2/..." Files="Engine/TestNumber2/..."/>
				<Log Message="Here are all the files in Engine/TestNumber3/..." Files="Engine/TestNumber3/..."/>
				<Log Message="Here are all the files in Engine/TestNumber4/..." Files="Engine/TestNumber4/..."/>
				<Log Message="Here are all the files in Engine/TestNumber5/..." Files="Engine/TestNumber5/..."/>
			</Node>
		</Agent>
	</Trigger>
	
	<!-- Aggregates for the build process -->
	<Aggregate Name="Tag and File Examples" Requires="Print all Output Folders;Consume a Single Named Output"/>
</BuildGraph>
